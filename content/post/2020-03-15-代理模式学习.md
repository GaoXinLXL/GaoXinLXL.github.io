---
title: ä»£ç†æ¨¡å¼å­¦ä¹ 

date: '2020-03-15'
categories:
    - ç¬”è®°
tags:
    - Java

---

# [](#é™æ€ä»£ç† "é™æ€ä»£ç†")é™æ€ä»£ç†

1.  åˆ›å»ºæ¥å£
2.  åˆ›å»ºè¢«ä»£ç†ç±»

    å®ç°æ¥å£
3.  åˆ›å»ºä»£ç†ç±»

    ä¹Ÿè¦å®ç°åŒæ ·çš„æ¥å£ï¼ŒåŒæ—¶è¿˜è¦æŒæœ‰è¢«ä»£ç†å¯¹è±¡çš„å¼•ç”¨
4.  ä»£ç†ç±»å‘æŒ¥ä½œç”¨

    ä»£ç†ç±»æ‰§è¡Œæ–¹æ³•ï¼ˆå…¶å®çœŸæ­£æ‰§è¡Œçš„æ ¸å¿ƒæ–¹æ³•æ˜¯è¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼‰

```java
interface Print{//æ¥å£
    public void print();
}

class Printer implements Print{//è¢«ä»£ç†ç±»
    @Override
    public void print() {
        System.out.println("æ‰“å°ä¸­ã€‚ã€‚ã€‚");
    }
}

class ProxyPrinter implements Print{//ä»£ç†ç±»
    private Printer printer;//è¦å¾—åˆ°è¢«ä»£ç†ç±»çš„å¼•ç”¨
    ProxyPrinter(Printer printer) {
        this.printer = printer;
    }
    @Override
    public void print() {
        System.out.println("æ‰“å°å‰ã€‚ã€‚ã€‚");
        printer.print();//è°ƒç”¨è¢«ä»£ç†ç±»çš„æ–¹æ³•
        System.out.println("æ‰“å°åã€‚ã€‚ã€‚");
    }
}


public class Main {
    public static void main(String[] args){
        Print p = new ProxyPrinter(new Printer());//è¿™é‡Œç”¨äº†å‘ä¸Šè½¬å‹
        p.print();
    }
}
```

```java
æ‰“å°å‰ã€‚ã€‚ã€‚
æ‰“å°ä¸­ã€‚ã€‚ã€‚
æ‰“å°åã€‚ã€‚ã€‚
```

# [](#åŠ¨æ€ä»£ç† "åŠ¨æ€ä»£ç†")åŠ¨æ€ä»£ç†

å’Œé™æ€ä»£ç†ç›¸æ¯”ï¼Œåˆ›å»ºæ¥å£ã€åˆ›å»ºçœŸå®çš„è¢«ä»£ç†ç±»éƒ½ä¸å˜ã€‚

1.  åˆ›å»ºæ¥å£
2.  åˆ›å»ºè¢«ä»£ç†ç±»

å®ç°æ¥å£

3.  åˆ›å»ºä¸€ä¸ªå®ç°InvocationHandleræ¥å£çš„ç±»ï¼ˆä¸ºäº†å¥½è®°ï¼Œæˆ‘å«å®ƒæ‹¦æˆªç±»ï¼Œå¯ä»¥æ‹¦æˆªè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼‰

è·Ÿé™æ€ä»£ç†é‡Œé¢ä»£ç†ç±»ä¸€æ ·ï¼Œè¦è·å¾—è¢«ä»£ç†ç±»å¯¹è±¡çš„å¼•ç”¨ï¼ˆä½†ä¸æ˜¯ä»£ç†ç±»ï¼‰  
è¿˜å¿…é¡»å®ç°invoke()æ–¹æ³•ï¼Œè¿™é‡Œé¢å¯ä»¥å¯¹è¢«ä»£ç†ç±»çš„æ–¹æ³•è¿›è¡Œå¢å¼º

4.  å¦‚ä½•è¿ç”¨ï¼Ÿ

åˆ›å»ºæ‹¦æˆªç±»å¯¹è±¡ï¼Œä¼ å…¥çœŸå®çš„è¢«ä»£ç†ç±»å¯¹è±¡  
ç”±Proxyç±»çš„é™æ€æ–¹æ³•_newProxyInstance(3ä¸ªå‚æ•°)è·å¾—çœŸæ­£çš„ä»£ç†å¯¹è±¡ï¼Œå¹¶å‘ä¸Šè½¬å‹ä¸ºæ¥å£ç±»å‹_  
_ä»£ç†ç±»å¯¹è±¡æ‰§è¡Œæ–¹æ³•_

```java
interface Print{//æ¥å£
    public void print();
}

class Printer implements Print{//è¢«ä»£ç†ç±»
    @Override
    public void print() {
        System.out.println("æ‰“å°ä¸­ã€‚ã€‚ã€‚");
    }
}

class ProxyInvocationHandler implements InvocationHandler{

    /**
     *  è¢«ä»£ç†çš„å¼•ç”¨
     *  è¿™é‡Œç”¨Printer printerä¹Ÿå¯ä»¥è¿è¡Œï¼Œä½†æ²¡æœ‰ç”¨objectæœ‰æ„ä¹‰
     *  è¿™æ ·æ›´çµæ´»ï¼Œæ‰èƒ½ä½“ç°åŠ¨æ€ä»£ç†çš„åŠ¨æ€
    */
    private Object object;

    ProxyInvocationHandler(Object object) {
        this.object = object;
    }

    //å¤„ç†ä»£ç†å®ä¾‹ï¼Œå¹¶è¿”å›ç»“æœ
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println("æ‰“å°å‰ã€‚ã€‚ã€‚");
        Object result = method.invoke(object,args);
        System.out.println("æ‰“å°åã€‚ã€‚ã€‚");
        return result;
    }
}

public class Main {
    public static void main(String[] args){
        ProxyInvocationHandler pih = new ProxyInvocationHandler(new Printer());
        Print printer = (Print)Proxy.newProxyInstance(
            Printer.class.getClassLoader(),Printer.class.getInterfaces(),pih);
        printer.print();
    }
}
```

```java
æ‰“å°å‰ã€‚ã€‚ã€‚
æ‰“å°ä¸­ã€‚ã€‚ã€‚
æ‰“å°åã€‚ã€‚ã€‚
```


å¯¹äºåŠ¨æ€ä»£ç†ï¼Œé‡ç‚¹è¦ç†è§£ä¸‹é¢2ä¸ªæ–¹æ³•ï¼š


ğŸ”¨Proxy.newProxyInstance(3ä¸ªå‚æ•°)æ–¹æ³•  
æ­¤æ–¹æ³•ç”¨äºç”ŸæˆçœŸæ­£çš„ä»£ç†å¯¹è±¡

```java
static Object    newProxyInstance(ClassLoader loader, ç±»<?>[] interfaces, InvocationHandler h) 
```

3ä¸ªå‚æ•°ï¼š

1.  loader è¢«ä»£ç†ç±»ï¼ˆç›®æ ‡å¯¹è±¡ï¼‰çš„ç±»åŠ è½½å™¨
2.  interface ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£
3.  h â€œæ‹¦æˆªç±»â€å¯¹è±¡

æ³¨æ„è¿”å›çš„çœŸæ­£çš„ä»£ç†å¯¹è±¡éœ€è¦è½¬å‹ã€‚


ğŸ”¨â€œæ‹¦æˆªç±»â€é‡Œå¿…é¡»é‡å†™çš„invoke(å‚æ•°)æ–¹æ³•  
å…¶å®å°±æ˜¯è¦ç†è§£method.invoke(å‚æ•°)ï¼Œåˆ©ç”¨äº†åå°„ï¼Œå¯ä»¥ç®€å•åœ°è®¤ä¸ºç”¨æ¥æ‰§è¡ŒæŸä¸ªçš„å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•

```java
public Object invoke(Object obj,
                     Object... args)
              throws IllegalAccessException,
                     IllegalArgumentException,
                     InvocationTargetException
```

# [](#ClassLoaderæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ "ClassLoaderæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ")ClassLoaderæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ

å®ƒæ˜¯ç”¨æ¥åŠ è½½ Class çš„ã€‚å®ƒè´Ÿè´£å°† Class çš„å­—èŠ‚ç å½¢å¼è½¬æ¢æˆå†…å­˜å½¢å¼çš„ Class å¯¹è±¡ã€‚å­—èŠ‚ç å¯ä»¥æ¥è‡ªäºç£ç›˜æ–‡ä»¶ \*.classï¼Œä¹Ÿå¯ä»¥æ˜¯ jar åŒ…é‡Œçš„ \*.classç­‰ã€‚å­—èŠ‚ç çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ \[\]byteã€‚

> æ¯ä¸ª Class å¯¹è±¡é‡Œé¢éƒ½æœ‰ä¸€ä¸ª classLoader å±æ€§è®°å½•äº†å½“å‰çš„ç±»æ˜¯ç”±è°æ¥åŠ è½½çš„ã€‚


âœ¨3ä¸ªé‡è¦çš„ClassLoader  
JVM ä¸­å†…ç½®äº†ä¸‰ä¸ªé‡è¦çš„ ClassLoaderï¼Œåˆ†åˆ«æ˜¯

*   BootstrapClassLoader
*   ExtensionClassLoader
*   AppClassLoaderã€‚

    > BootstrapClassLoader è´Ÿè´£åŠ è½½ JVM è¿è¡Œæ—¶æ ¸å¿ƒç±»ï¼Œè¿™äº›ç±»ä½äº JAVA\_HOME/lib/rt.jar æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨å†…ç½®åº“ java.xxx.\* éƒ½åœ¨é‡Œé¢ï¼Œæ¯”å¦‚ java.util._ã€java.io._ã€java.nio._ã€java.lang._ ç­‰ç­‰ã€‚è¿™ä¸ª ClassLoader æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒæ˜¯ç”± C ä»£ç å®ç°çš„ï¼Œæˆ‘ä»¬å°†å®ƒç§°ä¹‹ä¸ºã€Œæ ¹åŠ è½½å™¨ã€ã€‚


ğŸ’¤

> ExtensionClassLoader è´Ÿè´£åŠ è½½ JVM æ‰©å±•ç±»ï¼Œæ¯”å¦‚ swing ç³»åˆ—ã€å†…ç½®çš„ js å¼•æ“ã€xml è§£æå™¨ ç­‰ç­‰ï¼Œè¿™äº›åº“åé€šå¸¸ä»¥ javax å¼€å¤´ï¼Œå®ƒä»¬çš„ jar åŒ…ä½äº JAVA\_HOME/lib/ext/\*.jar ä¸­ï¼Œæœ‰å¾ˆå¤š jar åŒ…ã€‚

ğŸ’¦

> AppClassLoader æ‰æ˜¯ç›´æ¥é¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œå®ƒä¼šåŠ è½½ Classpath ç¯å¢ƒå˜é‡é‡Œå®šä¹‰çš„è·¯å¾„ä¸­çš„ jar åŒ…å’Œç›®å½•ã€‚æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ä»£ç ä»¥åŠä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ jar åŒ…é€šå¸¸éƒ½æ˜¯ç”±å®ƒæ¥åŠ è½½çš„ã€‚

# [](#åŒäº²å§”æ´¾ "åŒäº²å§”æ´¾")åŒäº²å§”æ´¾

> æ¯ä¸ª ClassLoader éƒ½å¾ˆæ‡’ï¼Œå°½é‡æŠŠå·¥ä½œäº¤ç»™çˆ¶äº²åšï¼Œçˆ¶äº²å¹²ä¸äº†äº†è‡ªå·±æ‰ä¼šå¹²ã€‚æ¯ä¸ª ClassLoader å¯¹è±¡å†…éƒ¨éƒ½ä¼šæœ‰ä¸€ä¸ª parent å±æ€§æŒ‡å‘å®ƒçš„çˆ¶åŠ è½½å™¨ã€‚

ğŸ›´

> AppClassLoader åœ¨åŠ è½½ä¸€ä¸ªæœªçŸ¥çš„ç±»åæ—¶ï¼Œå®ƒå¹¶ä¸æ˜¯ç«‹å³å»æœå¯» Classpathï¼Œå®ƒä¼šé¦–å…ˆå°†è¿™ä¸ªç±»åç§°äº¤ç»™ ExtensionClassLoader æ¥åŠ è½½ï¼Œå¦‚æœ ExtensionClassLoader å¯ä»¥åŠ è½½ï¼Œé‚£ä¹ˆ AppClassLoader å°±ä¸ç”¨éº»çƒ¦äº†ã€‚å¦åˆ™å®ƒå°±ä¼šæœç´¢ Classpath ã€‚  
> è€Œ ExtensionClassLoader åœ¨åŠ è½½ä¸€ä¸ªæœªçŸ¥çš„ç±»åæ—¶ï¼Œå®ƒä¹Ÿå¹¶ä¸æ˜¯ç«‹å³æœå¯» ext è·¯å¾„ï¼Œå®ƒä¼šé¦–å…ˆå°†ç±»åç§°äº¤ç»™ BootstrapClassLoader æ¥åŠ è½½ï¼Œå¦‚æœ BootstrapClassLoader å¯ä»¥åŠ è½½ï¼Œé‚£ä¹ˆ ExtensionClassLoader ä¹Ÿå°±ä¸ç”¨éº»çƒ¦äº†ã€‚å¦åˆ™å®ƒå°±ä¼šæœç´¢ ext è·¯å¾„ä¸‹çš„ jar åŒ…ã€‚

# [](#getInterfaces "getInterfaces()")getInterfaces()

ä»¥ä¸‹æ˜¯**java.lang.Class.getInterfaces()**æ–¹æ³•çš„å£°æ˜

```java
public Class<?>[] getInterfaces()
```

æ­¤æ–¹æ³•è¿”å›è¿™ä¸ªç±»ä¸­å®ç°æ¥å£çš„æ•°ç»„ã€‚

